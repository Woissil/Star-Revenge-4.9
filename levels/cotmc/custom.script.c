#include <ultra64.h>
#include "sm64.h"
#include "behavior_data.h"
#include "model_ids.h"
#include "seq_ids.h"
#include "dialog_ids.h"
#include "segment_symbols.h"
#include "level_commands.h"
#include "game/level_update.h"
#include "levels/scripts.h"
#include "actors/common1.h"
#include "make_const_nonconst.h"

#include "areas/2/custom.model.inc.h"

#include "levels/cotmc/header.h"
#include "levels/bbh/header.h"

extern u8 _cotmc_segment_ESegmentRomStart[];
extern u8 _cotmc_segment_ESegmentRomEnd[];

const LevelScript level_cotmc_entry[] = {
	INIT_LEVEL(),
	LOAD_MIO0(0x07, _bbh_segment_7SegmentRomStart, _bbh_segment_7SegmentRomEnd),
	LOAD_RAW(0x1A, _bbhSegmentRomStart, _bbhSegmentRomEnd),
	LOAD_RAW(0x0E, _cotmc_segment_ESegmentRomStart, _cotmc_segment_ESegmentRomEnd),
	LOAD_MIO0(0xA, _SkyboxCustom44457808_skybox_mio0SegmentRomStart, _SkyboxCustom44457808_skybox_mio0SegmentRomEnd),
	LOAD_MIO0(8, _common0_mio0SegmentRomStart, _common0_mio0SegmentRomEnd),
	LOAD_RAW(15, _common0_geoSegmentRomStart, _common0_geoSegmentRomEnd),
	ALLOC_LEVEL_POOL(),
	MARIO(/*model*/ MODEL_MARIO, /*behParam*/ 0x00000001, /*beh*/ bhvMario),
	// Level Specific Models
	LOAD_MODEL_FROM_GEO(MODEL_BBH_HAUNTED_DOOR,           haunted_door_geo),
	LOAD_MODEL_FROM_GEO(MODEL_BBH_STAIRCASE_STEP,         geo_bbh_0005B0),
	LOAD_MODEL_FROM_GEO(MODEL_BBH_TILTING_FLOOR_PLATFORM, geo_bbh_0005C8),
	LOAD_MODEL_FROM_GEO(MODEL_BBH_TUMBLING_PLATFORM,      geo_bbh_0005E0),
	LOAD_MODEL_FROM_GEO(MODEL_BBH_TUMBLING_PLATFORM_PART, geo_bbh_0005F8),
	LOAD_MODEL_FROM_GEO(MODEL_BBH_MOVING_BOOKSHELF,       geo_bbh_000610),
	LOAD_MODEL_FROM_GEO(MODEL_BBH_MESH_ELEVATOR,          geo_bbh_000628),
	LOAD_MODEL_FROM_GEO(MODEL_BBH_MERRY_GO_ROUND,         geo_bbh_000640),
	LOAD_MODEL_FROM_GEO(MODEL_BBH_WOODEN_TOMB,            geo_bbh_000658),
	// Unspecified Models
	LOAD_MODEL_FROM_GEO(22,  warp_pipe_geo),
	LOAD_MODEL_FROM_GEO(23,  bubbly_tree_geo),
	LOAD_MODEL_FROM_GEO(24,  spiky_tree_geo),
	LOAD_MODEL_FROM_GEO(25,  snow_tree_geo),
	LOAD_MODEL_FROM_GEO(27,  palm_tree_geo),
	LOAD_MODEL_FROM_GEO(31,  metal_door_geo),
	LOAD_MODEL_FROM_GEO(32,  hazy_maze_door_geo),
	LOAD_MODEL_FROM_GEO(34,  castle_door_0_star_geo),
	LOAD_MODEL_FROM_GEO(35,  castle_door_1_star_geo),
	LOAD_MODEL_FROM_GEO(36,  castle_door_3_stars_geo),
	LOAD_MODEL_FROM_GEO(37,  key_door_geo),
	LOAD_MODEL_FROM_GEO(38,  castle_door_geo),
	LOAD_MODEL_FROM_GEO(7, box7star),
	LOAD_MODEL_FROM_GEO(8, boxstar),
	LOAD_MODEL_FROM_GEO(9, wingbox),
	LOAD_MODEL_FROM_GEO(10, vanishbox),
	LOAD_MODEL_FROM_GEO(11, metalbox),
	LOAD_MODEL_FROM_GEO(12, warpbox),
	// LOAD_MODEL_FROM_GEO(131, 0x0404fe00),
	// LOAD_MODEL_FROM_DL(132, 0x08025f08, 4),
	// LOAD_MODEL_FROM_GEO(137, 0x04050000),
	// LOAD_MODEL_FROM_DL(158, 0x0302c8a0, 4),
	// LOAD_MODEL_FROM_DL(159, 0x0302bcd0, 4),
	// LOAD_MODEL_FROM_DL(161, 0x0301cb00, 4),
	// LOAD_MODEL_FROM_DL(164, 0x04032a18, 4),
	// LOAD_MODEL_FROM_DL(201, 0x080048e0, 4),
	// LOAD_MODEL_FROM_DL(218, 0x08024bb8, 4),
	JUMP_LINK(script_func_global_1),
	JUMP_LINK(local_area_cotmc_2_),
	FREE_LEVEL_POOL(),
	MARIO_POS(1, 0, 0, 0, 0),
	CALL(/*arg*/ 0, /*func*/ lvl_init_or_update),
	CALL_LOOP(/*arg*/ 1, /*func*/ lvl_init_or_update),
	CLEAR_LEVEL(),
	SLEEP_BEFORE_EXIT(/*frames*/ 1),
	EXIT(),
};

const LevelScript local_area_cotmc_2_[] = {
	AREA(2, Geo_cotmc_2_0x2a8be70),
	TERRAIN(col_cotmc_2_0xe0f3e20),
	SET_BACKGROUND_MUSIC(0, 52),
	TERRAIN_TYPE(0),
	JUMP_LINK(local_objects_cotmc_2_),
	JUMP_LINK(local_warps_cotmc_2_),
	END_AREA(),
	RETURN()
};

const LevelScript local_objects_cotmc_2_[] = {
	OBJECT_WITH_ACTS(0, 0, 72, 6, 0, 180, 0, 0xa0000,  bhvSpinAirborneWarp, 31),
	OBJECT_WITH_ACTS(8, -81, 9724, 12103, 0, 0, 0, 0x80000,  bhvExclamationBox, 31),
	OBJECT_WITH_ACTS(46, -3140, 5190, 6346, 0, 90, 0, 0x0,  bhvCheckpoint_Flag_MOP, 31),
	OBJECT_WITH_ACTS(46, -4385, 4955, -9761, 0, -90, 0, 0x0,  bhvCheckpoint_Flag_MOP, 31),
	OBJECT_WITH_ACTS(46, 5101, 4558, 5617, 0, 0, 0, 0x0,  bhvCheckpoint_Flag_MOP, 31),
	OBJECT_WITH_ACTS(0, 619, 7007, 5364, 0, 0, 0, 0x10000,  bhvFadingWarp, 31),
	OBJECT_WITH_ACTS(0, 8604, 4889, -7670, 0, 0, 0, 0x20000,  bhvFadingWarp, 31),
	OBJECT_WITH_ACTS(0, -9591, 8610, 9368, 0, 0, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(180, -10529, 7200, 8908, 0, 0, 0, 0x0,  bhvFireSpitter, 31),
	OBJECT_WITH_ACTS(0, -9297, 6480, 8224, 0, 0, 0, 0x0,  bhvGoombaTripletSpawner, 31),
	OBJECT_WITH_ACTS(0, -9261, 6480, 6360, 0, 0, 0, 0x0,  bhvGoombaTripletSpawner, 31),
	OBJECT_WITH_ACTS(223, -5798, 6540, 6367, 0, 0, 0, 0x0,  bhvChuckya, 31),
	OBJECT_WITH_ACTS(223, -1400, 4890, 6367, 0, 0, 0, 0x0,  bhvChuckya, 31),
	OBJECT_WITH_ACTS(0, -3800, 4050, 6339, 0, 0, 0, 0x110000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(180, -729, 3390, 5620, 0, 0, 0, 0x0,  bhvFireSpitter, 31),
	OBJECT_WITH_ACTS(223, -2013, 1860, 3961, 0, 0, 0, 0x0,  bhvChuckya, 31),
	OBJECT_WITH_ACTS(0, -3798, 1035, 3956, 0, 0, 0, 0x110000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, -5135, 1965, 3913, 0, 0, 0, 0x110000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(180, 1003, 2745, -4559, 0, 0, 0, 0x0,  bhvFireSpitter, 31),
	OBJECT_WITH_ACTS(0, -13645, 8653, -1554, 0, 0, 0, 0x100000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, -13653, 7789, -2369, 0, 0, 0, 0x110000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, -13685, 6535, -1748, 0, 0, 0, 0x110000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, -13685, 4963, -1748, 0, 0, 0, 0x0,  bhvGoombaTripletSpawner, 31),
	OBJECT_WITH_ACTS(120, -11544, 4051, -688, 0, 0, 0, 0x0,  bhvRecoveryHeart, 31),
	OBJECT_WITH_ACTS(116, -11517, 3913, -2426, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(116, -10733, 3913, -2934, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(116, -10028, 3913, -3372, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(0, -7747, 5639, -2163, 0, 0, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, -6152, 6378, -2189, 0, 0, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(192, -5227, 4422, -3366, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(192, -4496, 3627, -2192, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(192, -986, 8964, -11777, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(192, -2339, 9564, -11797, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(192, -3291, 8964, -10805, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(192, -4640, 9564, -10833, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(0, -6453, 9959, -10830, 0, 90, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(120, -6616, 4295, -9854, 0, 0, 0, 0x0,  bhvRecoveryHeart, 31),
	OBJECT_WITH_ACTS(120, -6620, 4295, -9926, 0, 0, 0, 0x0,  bhvRecoveryHeart, 31),
	OBJECT_WITH_ACTS(120, -6618, 4295, -10009, 0, 0, 0, 0x0,  bhvRecoveryHeart, 31),
	OBJECT_WITH_ACTS(194, -3800, 4265, -6217, 0, 0, 0, 0x0,  bhvCirclingAmp, 31),
	OBJECT_WITH_ACTS(0, -3779, 3881, -5456, 0, 0, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, -3776, 4565, -7080, 0, 0, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, -3778, 5099, -8503, 0, 0, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(192, -3781, 5255, -9181, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(0, -1005, 5639, -9771, 0, 90, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(180, 357, 4511, -11298, 0, 0, 0, 0x0,  bhvFireSpitter, 31),
	OBJECT_WITH_ACTS(180, 101, 3929, -8879, 0, 0, 0, 0x0,  bhvFireSpitter, 31),
	OBJECT_WITH_ACTS(0, 1872, 3209, -7072, 0, 0, 0, 0x110000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, 285, 1637, -6186, 0, 0, 0, 0x110000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, 507, 593, -6423, 0, 0, 0, 0x0,  bhvGoombaTripletSpawner, 31),
	OBJECT_WITH_ACTS(180, -8, 593, -2671, 0, 0, 0, 0x0,  bhvFireSpitter, 31),
	OBJECT_WITH_ACTS(122, 855, 1139, -7771, 0, 0, 0, 0x6000000,  bhvStar, 31),
	OBJECT_WITH_ACTS(122, 4622, 10481, -416, 0, 0, 0, 0x5000000,  bhvStar, 31),
	OBJECT_WITH_ACTS(122, 8609, 8949, -7676, 0, 0, 0, 0x4000000,  bhvStar, 31),
	OBJECT_WITH_ACTS(122, 434, 8841, -11797, 0, 0, 0, 0x3000000,  bhvStar, 31),
	OBJECT_WITH_ACTS(122, -13652, 8401, 3214, 0, 0, 0, 0x2000000,  bhvStar, 31),
	OBJECT_WITH_ACTS(122, -9599, 11312, 5709, 0, 0, 0, 0x1000000,  bhvStar, 31),
	OBJECT_WITH_ACTS(0, 2353, 10144, -418, 0, 90, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, 611, 8740, -421, 0, 90, 0, 0x110000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(192, 2434, 6982, 674, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(192, 3691, 6462, 1574, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(192, 3574, 6462, 1808, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(192, 8629, 7167, -1017, 0, 90, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(0, 8606, 6453, -1865, 0, 90, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, 3153, 6495, 12006, 0, 0, 0, 0x110000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(120, 2257, 4629, 11906, 0, 0, 0, 0x0,  bhvRecoveryHeart, 31),
	OBJECT_WITH_ACTS(0, 3851, 4119, 10733, 0, 0, 0, 0x110000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(223, 5046, 4119, 10718, 0, 0, 0, 0x0,  bhvChuckya, 31),
	OBJECT_WITH_ACTS(180, 8306, 6246, 8355, 0, 0, 0, 0x0,  bhvFireSpitter, 31),
	OBJECT_WITH_ACTS(192, 7732, 4716, 5591, 0, 0, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(223, 4988, 3151, 5644, 0, 0, 0, 0x0,  bhvChuckya, 31),
	OBJECT_WITH_ACTS(0, 5099, 2640, 3903, 0, 0, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, 614, 7068, 5351, 0, 0, 0, 0x20000,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, 1883, 6162, 6146, 0, 0, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(0, 545, 6162, 6857, 0, 90, 0, 0x0,  bhvCoinFormation, 31),
	OBJECT_WITH_ACTS(180, -9601, 10596, 6222, 0, 0, 0, 0x0,  bhvFireSpitter, 31),
	OBJECT_WITH_ACTS(116, 0, 107, -678, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(116, 0, 107, -678, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(116, 0, 107, -678, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(116, -567, 107, 315, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(116, -567, 107, 315, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(116, 567, 107, 315, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(116, 567, 107, 315, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(124, -5826, 4955, -9629, 0, 90, 0, 0x430000,  bhvMessagePanel, 31),
	OBJECT_WITH_ACTS(116, 856, 1108, -7970, 0, 0, 0, 0x0,  bhvOneCoin, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 328,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 329,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 330,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 331,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 332,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 333,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 334,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 335,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 336,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 337,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 338,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 339,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 340,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 341,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 342,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 343,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 344,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 345,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 346,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 347,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 348,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 349,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 350,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 351,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 352,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 353,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 354,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 355,  RM_Scroll_Texture, 31),
	OBJECT_WITH_ACTS(0, -10, 4, 15, 0, 0, 20, 356,  RM_Scroll_Texture, 31),
	RETURN()
};

const LevelScript local_warps_cotmc_2_[] = {
	WARP_NODE(10, 9, 1, 0, 0),
	WARP_NODE(0, 28, 2, 0, 0),
	WARP_NODE(1, 28, 2, 2, 0),
	WARP_NODE(2, 28, 2, 1, 0),
	WARP_NODE(240, 16, 2, 32, 0),
	WARP_NODE(241, 16, 2, 33, 0),
	RETURN()
};